<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>HighRoll Overlay</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: transparent;
      font-family: Arial, sans-serif;
      color: white;
      overflow: hidden;
    }

    #overlay-container {
      background-color: rgba(30, 30, 30, 0.8);
      border: 1px solid #0078d4;
      border-radius: 4px;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    #header {
      background-color: #0078d4;
      padding: 5px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: move;
      user-select: none;
    }

    #content {
      padding: 10px;
      flex: 1;
      overflow-y: auto;
    }

    button {
      background-color: #005a9e;
      color: white;
      border: none;
      padding: 2px 5px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 5px;
    }

    .shortcut {
      display: inline-block;
      background-color: #333;
      padding: 2px 4px;
      border-radius: 3px;
      margin: 0 2px;
      font-size: 12px;
    }

    .click-through-enabled {
      border-color: #00d084;
    }

    .click-through-enabled #header {
      background-color: #00d084;
    }

    .controls {
      display: flex;
      align-items: center;
    }

    .resize-handle {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 15px;
      height: 15px;
      cursor: nwse-resize;
      background-color: #0078d4;
      border-top-left-radius: 3px;
    }

    .click-through-enabled .resize-handle {
      background-color: #00d084;
    }

    .game-state {
      margin-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 10px;
    }

    .game-state-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .game-state-title {
      font-weight: bold;
      font-size: 14px;
      color: #0078d4;
    }

    .game-state-info {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .game-state-item {
      background-color: rgba(0, 0, 0, 0.2);
      padding: 5px 8px;
      border-radius: 3px;
      font-size: 12px;
    }

    .game-state-label {
      color: #999;
      margin-right: 5px;
    }

    .game-state-value {
      color: white;
      font-weight: bold;
    }

    .champion-list,
    .trait-list,
    .augment-list {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-bottom: 15px;
    }

    .champion-item,
    .trait-item,
    .augment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.2);
      padding: 5px 8px;
      border-radius: 3px;
      font-size: 12px;
    }

    .champion-cost-1 {
      border-left: 3px solid #cccccc;
    }

    .champion-cost-2 {
      border-left: 3px solid #11b288;
    }

    .champion-cost-3 {
      border-left: 3px solid #207ac7;
    }

    .champion-cost-4 {
      border-left: 3px solid #c440da;
    }

    .champion-cost-5 {
      border-left: 3px solid #ffb93b;
    }

    .trait-active {
      color: #00d084;
    }

    .trait-inactive {
      color: #999;
    }

    .augment-tier-1 {
      color: #11b288;
    }

    .augment-tier-2 {
      color: #207ac7;
    }

    .augment-tier-3 {
      color: #ffb93b;
    }

    .section-title {
      font-size: 12px;
      font-weight: bold;
      margin: 10px 0 5px 0;
      color: #0078d4;
    }

    .opacity-control {
      display: flex;
      align-items: center;
      margin-left: 10px;
    }

    .opacity-slider {
      width: 60px;
      margin: 0 5px;
    }
  </style>
</head>

<body>
  <div id="overlay-container">
    <div id="header">
      <div>HighRoll TFT Overlay</div>
      <div class="controls">
        <div class="opacity-control">
          <span>Opacity:</span>
          <input type="range" min="0.1" max="1" step="0.05" value="0.8" class="opacity-slider" id="opacitySlider">
        </div>
        <button id="toggleClickThrough">Toggle Click-Through</button>
      </div>
    </div>

    <div id="content">
      <div class="game-state">
        <div class="game-state-header">
          <div class="game-state-title">Current Game State</div>
          <div id="stage-indicator" class="game-state-item">
            <span class="game-state-label">Stage:</span>
            <span class="game-state-value" id="stage-value">Loading...</span>
          </div>
        </div>

        <div class="game-state-info">
          <div class="game-state-item">
            <span class="game-state-label">Round:</span>
            <span class="game-state-value" id="round-value">-</span>
          </div>
          <div class="game-state-item">
            <span class="game-state-label">Health:</span>
            <span class="game-state-value" id="health-value">-</span>
          </div>
          <div class="game-state-item">
            <span class="game-state-label">Gold:</span>
            <span class="game-state-value" id="gold-value">-</span>
          </div>
          <div class="game-state-item">
            <span class="game-state-label">Level:</span>
            <span class="game-state-value" id="level-value">-</span>
          </div>
        </div>

        <div class="section-title">Champions</div>
        <div id="champions-list" class="champion-list">
          <div class="champion-item">Loading champions...</div>
        </div>

        <div class="section-title">Traits</div>
        <div id="traits-list" class="trait-list">
          <div class="trait-item">Loading traits...</div>
        </div>

        <div class="section-title">Augments</div>
        <div id="augments-list" class="augment-list">
          <div class="augment-item">Loading augments...</div>
        </div>
      </div>

      <p><small>Press <span class="shortcut">Alt</span> + <span class="shortcut">Shift</span> + <span
            class="shortcut">O</span> to toggle overlay visibility</small></p>
      <p><small>Press <span class="shortcut">Alt</span> + <span class="shortcut">Shift</span> + <span
            class="shortcut">C</span> to toggle click-through mode</small></p>
    </div>

    <div class="resize-handle" id="resizeHandle"></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    // Get elements
    const container = document.getElementById('overlay-container');
    const header = document.getElementById('header');
    const toggleClickThroughBtn = document.getElementById('toggleClickThrough');
    const opacitySlider = document.getElementById('opacitySlider');
    const resizeHandle = document.getElementById('resizeHandle');

    // Get game state elements
    const stageValue = document.getElementById('stage-value');
    const roundValue = document.getElementById('round-value');
    const healthValue = document.getElementById('health-value');
    const goldValue = document.getElementById('gold-value');
    const levelValue = document.getElementById('level-value');
    const championsList = document.getElementById('champions-list');
    const traitsList = document.getElementById('traits-list');
    const augmentsList = document.getElementById('augments-list');

    // Track drag state
    let isDragging = false;
    let isResizing = false;
    let dragStartPos = { x: 0, y: 0 };
    let currentPosition = { x: 0, y: 0 };
    let resizeStartPos = { x: 0, y: 0 };
    let currentSize = { width: 400, height: 300 };

    // Make the overlay draggable
    header.addEventListener('mousedown', (e) => {
      isDragging = true;

      // We don't have direct access to window position, so we'll track relative movement
      dragStartPos = {
        x: e.clientX,
        y: e.clientY
      };
    });

    // Make the overlay resizable
    resizeHandle.addEventListener('mousedown', (e) => {
      isResizing = true;
      e.stopPropagation();

      resizeStartPos = {
        x: e.clientX,
        y: e.clientY
      };

      // Get current window size
      ipcRenderer.invoke('get-overlay-size').then(([width, height]) => {
        currentSize = { width, height };
      });
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        const dx = e.screenX - dragStartPos.x;
        const dy = e.screenY - dragStartPos.y;

        // Update drag start position for next move event
        dragStartPos = {
          x: e.screenX,
          y: e.screenY
        };

        // Update current position
        currentPosition.x += dx;
        currentPosition.y += dy;

        // Send position to main process
        ipcRenderer.send('set-overlay-position', currentPosition.x, currentPosition.y);
      }

      if (isResizing) {
        const dx = e.clientX - resizeStartPos.x;
        const dy = e.clientY - resizeStartPos.y;

        // Update resize start position for next move event
        resizeStartPos = {
          x: e.clientX,
          y: e.clientY
        };

        // Update current size
        const newWidth = Math.max(300, currentSize.width + dx);
        const newHeight = Math.max(200, currentSize.height + dy);

        currentSize = {
          width: newWidth,
          height: newHeight
        };

        // Send resize to main process
        ipcRenderer.send('resize-overlay', newWidth, newHeight);
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      isResizing = false;
    });

    // Toggle click-through
    toggleClickThroughBtn.addEventListener('click', () => {
      ipcRenderer.send('toggle-click-through');
    });

    // Handle opacity changes
    opacitySlider.addEventListener('input', () => {
      const opacity = parseFloat(opacitySlider.value);
      ipcRenderer.send('set-overlay-transparency', opacity);
    });

    // Listen for click-through state changes
    ipcRenderer.on('click-through-changed', (event, isEnabled) => {
      updateClickThroughUI(isEnabled);
    });

    // Listen for game state updates
    ipcRenderer.on('game-state-updated', (event, gameState) => {
      updateGameStateUI(gameState);
    });

    // Update UI based on click-through state
    function updateClickThroughUI(isEnabled) {
      if (isEnabled) {
        container.classList.add('click-through-enabled');
        toggleClickThroughBtn.textContent = 'Disable Click-Through';
      } else {
        container.classList.remove('click-through-enabled');
        toggleClickThroughBtn.textContent = 'Enable Click-Through';
      }
    }

    // Update UI based on game state
    function updateGameStateUI(gameState) {
      // Update basic info
      stageValue.textContent = gameState.stage || '-';
      roundValue.textContent = gameState.round || '-';
      healthValue.textContent = gameState.health || '-';
      goldValue.textContent = gameState.gold || '-';
      levelValue.textContent = gameState.level || '-';

      // Update champions
      if (gameState.champions && gameState.champions.length > 0) {
        let championsHtml = '';
        gameState.champions.forEach(champion => {
          championsHtml += `
            <div class="champion-item champion-cost-${champion.cost}">
              <div>${champion.name} (${champion.stars}★)</div>
              <div>Cost: ${champion.cost}</div>
            </div>
          `;
        });
        championsList.innerHTML = championsHtml;
      } else {
        championsList.innerHTML = '<div class="champion-item">No champions</div>';
      }

      // Update traits
      if (gameState.traits && gameState.traits.length > 0) {
        let traitsHtml = '';
        gameState.traits.forEach(trait => {
          traitsHtml += `
            <div class="trait-item ${trait.active ? 'trait-active' : 'trait-inactive'}">
              <div>${trait.name}</div>
              <div>Count: ${trait.count}</div>
            </div>
          `;
        });
        traitsList.innerHTML = traitsHtml;
      } else {
        traitsList.innerHTML = '<div class="trait-item">No traits</div>';
      }

      // Update augments
      if (gameState.augments && gameState.augments.length > 0) {
        let augmentsHtml = '';
        gameState.augments.forEach(augment => {
          augmentsHtml += `
            <div class="augment-item augment-tier-${augment.tier}">
              <div>${augment.name}</div>
              <div>Tier: ${augment.tier}</div>
            </div>
          `;
        });
        augmentsList.innerHTML = augmentsHtml;
      } else {
        augmentsList.innerHTML = '<div class="augment-item">No augments</div>';
      }
    }

    // Initialize
    async function initialize() {
      try {
        // Get initial click-through state
        const isClickThrough = await ipcRenderer.invoke('get-click-through-state');
        updateClickThroughUI(isClickThrough);

        // Get initial opacity
        const opacity = await ipcRenderer.invoke('get-overlay-opacity');
        opacitySlider.value = opacity;

        // Get initial game state
        const gameState = await ipcRenderer.invoke('get-game-state');
        if (gameState) {
          updateGameStateUI(gameState);
        }
      } catch (error) {
        console.error('Error initializing:', error);
      }
    }

    // Initialize the UI
    initialize();
  </script>
</body>

</html>